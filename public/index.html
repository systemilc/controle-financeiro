<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Finanças - Multi-Contas</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Tela de Login -->
    <div id="login-screen" class="container d-flex justify-content-center align-items-center vh-100">
        <div class="card p-4 shadow-sm w-100" style="max-width: 400px;">
            <h1 class="card-title text-center text-primary">Acesso Protegido</h1>
            <form id="login-form">
                <div class="mb-3">
                    <label for="username" class="form-label">Usuário:</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Senha:</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">Entrar</button>
                <p id="error-message" class="text-danger text-center mt-3 hidden">Usuário ou senha incorretos. Tente novamente.</p>
                <p class="text-center mt-3 mb-0">
                    Não tem uma conta? <a href="#register" data-page="register" id="show-register-link">Crie uma aqui</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Tela de Cadastro -->
    <div id="register-screen" class="container py-5 hidden">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="card p-4 shadow-sm w-100 mx-auto" style="max-width: 400px; overflow-y: auto; max-height: 85vh;">
                    <h1 class="card-title text-center text-primary">Criar Nova Conta</h1>
                    <form id="register-form">
                        <div class="mb-3">
                            <label for="register-username" class="form-label">Nome de Usuário:</label>
                            <input type="text" class="form-control" id="register-username" required>
                        </div>
                        <div class="mb-3">
                            <label for="register-password" class="form-label">Senha:</label>
                            <input type="password" class="form-control" id="register-password" minlength="6" required>
                            <small class="form-text text-muted">Mínimo 6 caracteres, com maiúscula, minúscula, número e caractere especial.</small>
                            <div id="password-strength" class="mt-1"></div>
                        </div>
                        <div class="mb-3">
                            <label for="register-confirm-password" class="form-label">Confirmar Senha:</label>
                            <input type="password" class="form-control" id="register-confirm-password" minlength="6" required>
                        </div>
                        <div class="mb-3">
                            <label for="register-whatsapp" class="form-label">WhatsApp:</label>
                            <input type="text" class="form-control" id="register-whatsapp" placeholder="(XX) XXXXX-XXXX">
                        </div>
                        <div class="mb-3">
                            <label for="register-instagram" class="form-label">Instagram:</label>
                            <input type="text" class="form-control" id="register-instagram" placeholder="@seuinstagram">
                        </div>
                        <div class="mb-3">
                            <label for="register-email" class="form-label">Email:</label>
                            <input type="email" class="form-control" id="register-email" required>
                        </div>
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input" id="consent-lgpd" required>
                            <label class="form-check-label" for="consent-lgpd">
                                Concordo com o <a href="#" data-bs-toggle="modal" data-bs-target="#lgpdModal">Termo de Consentimento</a> e aceito ser contatado via redes sociais para fins de marketing.
                            </label>
                            <div class="invalid-feedback">Você deve concordar para prosseguir.</div>
                        </div>
                        <button type="submit" class="btn btn-success w-100">Cadastrar</button>
                        <p id="register-error-message" class="text-danger text-center mt-3 hidden"></p>
                        <p class="text-center mt-3 mb-0">
                            Já tem uma conta? <a href="#login" data-page="login" id="show-login-link">Faça login aqui</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal LGPD -->
    <div class="modal fade" id="lgpdModal" tabindex="-1" aria-labelledby="lgpdModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="lgpdModalLabel">Termo de Consentimento LGPD</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Ao realizar o cadastro, você concorda que seus dados (Nome de Usuário, Email, WhatsApp e Instagram) sejam armazenados para fins de acesso ao sistema e contato para marketing. Garantimos o sigilo e a segurança das suas informações conforme a Lei Geral de Proteção de Dados (LGPD) - Lei nº 13.709/2018. Você pode solicitar a remoção ou correção dos seus dados a qualquer momento.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Entendi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Aplicação Principal -->
    <div id="main-app" class="d-flex hidden">
        <!-- Botão de toggle para mobile -->
        <button id="sidebar-toggle-mobile" class="sidebar-toggle-mobile">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Menu Lateral -->
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header d-flex justify-content-between align-items-center p-3">
                <h5 class="text-white mb-0">Finanças</h5>
                <button id="sidebar-toggle" class="btn btn-link text-white p-0">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" href="#dashboard" data-page="dashboard">
                        <i class="fas fa-tachometer-alt me-2"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#contas" data-page="contas">
                        <i class="fas fa-university me-2"></i>
                        <span class="nav-text">Contas Bancárias</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#categorias" data-page="categorias">
                        <i class="fas fa-tags me-2"></i>
                        <span class="nav-text">Categorias</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#tipos-pagamento" data-page="tipos-pagamento">
                        <i class="fas fa-credit-card me-2"></i>
                        <span class="nav-text">Tipos de Pagamento</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#importar-compra" data-page="importar-compra">
                        <i class="fas fa-file-excel me-2"></i>
                        <span class="nav-text">Importar Compra</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#compras-importadas" data-page="compras-importadas">
                        <i class="fas fa-receipt me-2"></i>
                        <span class="nav-text">Compras Importadas</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#produtos" data-page="produtos">
                        <i class="fas fa-box me-2"></i>
                        <span class="nav-text">Produtos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#transacoes" data-page="transacoes">
                        <i class="fas fa-exchange-alt me-2"></i>
                        <span class="nav-text">Transações</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#transferencia" data-page="transferencia">
                        <i class="fas fa-share-square me-2"></i>
                        <span class="nav-text">Transferência</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#usuarios" data-page="usuarios">
                        <i class="fas fa-users me-2"></i>
                        <span class="nav-text">Usuários</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#change-password" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                        <i class="fas fa-key me-2"></i>
                        <span class="nav-text">Alterar Senha</span>
                    </a>
                </li>
            </ul>
            
            <div class="sidebar-footer mt-auto p-3">
                <button id="logout-button" class="btn btn-danger w-100">
                    <i class="fas fa-sign-out-alt me-2"></i>
                    <span class="nav-text">Sair</span>
                </button>
            </div>
        </nav>

        <!-- Conteúdo Principal -->
        <div id="main-content" class="main-content">
            <!-- Header -->
            <header class="bg-white shadow-sm p-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h4 id="page-title" class="mb-0">Dashboard</h4>
                    <div class="d-flex align-items-center">
                        <span class="me-3">Bem-vindo, <strong id="current-user">Admin</strong></span>
                    </div>
                </div>
            </header>

            <!-- Container das Páginas -->
            <div class="container-fluid p-4">
                <!-- Dashboard -->
                <div id="dashboard-page" class="page-content">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Resumo Consolidado</h2>
                                <p class="mb-1">Receita Total: <span id="total-income" class="fw-bold text-success">R$ 0,00</span></p>
                                <p class="mb-1">Despesa Total: <span id="total-expense" class="fw-bold text-danger">R$ 0,00</span></p>
                                <p class="mb-1">Saldo Total: <span id="balance" class="fw-bold">R$ 0,00</span></p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Resumo por Conta</h2>
                                <div id="accounts-detailed-summary"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Filtros do Dashboard</h2>
                                <form id="dashboard-filters-form" class="mb-4">
                                    <div class="row g-3">
                                        <!-- Filtro por Tipo de Período -->
                                        <div class="col-md-6 col-lg-3">
                                            <label class="form-label d-block">Período:</label>
                                            <select class="form-select" id="dashboard-filter-period-type">
                                                <option value="due_date">Vencimento</option>
                                                <option value="created_at">Lançamento</option>
                                                <option value="confirmed_at">Confirmação</option>
                                            </select>
                                        </div>
                                        <!-- Filtro por Data Inicial e Final -->
                                        <div class="col-md-6 col-lg-3">
                                            <label for="dashboard-filter-date-start" class="form-label">Data Início:</label>
                                            <input type="date" class="form-control" id="dashboard-filter-date-start">
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <label for="dashboard-filter-date-end" class="form-label">Data Fim:</label>
                                            <input type="date" class="form-control" id="dashboard-filter-date-end">
                                        </div>
                                        <!-- Filtro por Tipo de Transação (Receita/Despesa) -->
                                        <div class="col-md-6 col-lg-3">
                                            <label class="form-label d-block">Tipo:</label>
                                            <select class="form-select" id="dashboard-filter-transaction-type">
                                                <option value="">Todos</option>
                                                <option value="income">Receita</option>
                                                <option value="expense">Despesa</option>
                                            </select>
                                        </div>
                                        <!-- Filtro por Categoria -->
                                        <div class="col-md-6 col-lg-3">
                                            <label for="dashboard-filter-category" class="form-label">Categoria:</label>
                                            <select class="form-select" id="dashboard-filter-category">
                                                <option value="">Todas</option>
                                                <!-- Categorias serão populadas via JS -->
                                            </select>
                                        </div>
                                        <!-- Filtro por Conta Bancária -->
                                        <div class="col-md-6 col-lg-3">
                                            <label for="dashboard-filter-account" class="form-label">Conta:</label>
                                            <select class="form-select" id="dashboard-filter-account">
                                                <option value="">Todas</option>
                                                <!-- Contas serão populadas via JS -->
                                            </select>
                                        </div>
                                        <div class="col-12 d-flex justify-content-end mt-4">
                                            <button type="button" id="dashboard-clear-filters-button" class="btn btn-secondary me-2"><i class="fas fa-times me-2"></i>Limpar Filtros</button>
                                            <button type="submit" id="dashboard-apply-filters-button" class="btn btn-primary"><i class="fas fa-filter me-2"></i>Aplicar Filtros</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Gráfico por Categoria/Tipo</h2>
                                <canvas id="pieChartCanvas"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Gráfico de Evolução</h2>
                                <canvas id="barChartCanvas"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Resumo Detalhado por Conta</h2>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Conta</th>
                                                <th class="text-center">Total Entradas</th>
                                                <th class="text-center">Total Saídas</th>
                                                <th class="text-center">Saldo</th>
                                                <th class="text-center">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="accounts-detailed-table">
                                            <!-- Dados serão inseridos via JavaScript -->
                                        </tbody>
                                        <tfoot class="table-light">
                                            <tr class="fw-bold">
                                                <td>TOTAL GERAL</td>
                                                <td class="text-center text-success" id="grand-total-income">R$ 0,00</td>
                                                <td class="text-center text-danger" id="grand-total-expense">R$ 0,00</td>
                                                <td class="text-center" id="grand-total-balance">R$ 0,00</td>
                                                <td class="text-center">
                                                    <span id="grand-total-status" class="badge bg-secondary">-</span>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contas Bancárias -->
                <div id="contas-page" class="page-content hidden">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card p-3 shadow-sm">
                                <form id="account-form">
                                    <h2 class="text-primary">Adicionar Conta</h2>
                                    <div class="mb-3">
                                        <label for="account-name" class="form-label">Nome da Conta:</label>
                                        <input type="text" class="form-control" id="account-name" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Adicionar Conta</button>
                                </form>
                            </div>
                            
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Lista de Contas</h2>
                                <ul id="accounts-list" class="list-group list-group-flush"></ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Categorias -->
                <div id="categorias-page" class="page-content hidden">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card p-3 shadow-sm">
                                <form id="category-form">
                                    <h2 class="text-primary">Adicionar Categoria</h2>
                                    <div class="mb-3">
                                        <label for="category-name" class="form-label">Nome da Categoria:</label>
                                        <input type="text" class="form-control" id="category-name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="category-type" class="form-label">Tipo:</label>
                                        <select class="form-select" id="category-type" required>
                                            <option value="">Selecione o tipo</option>
                                            <option value="income">Receita</option>
                                            <option value="expense">Despesa</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Adicionar Categoria</button>
                                </form>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Lista de Categorias</h2>
                                <ul id="categories-list" class="list-group list-group-flush"></ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tipos de Pagamento -->
                <div id="tipos-pagamento-page" class="page-content hidden">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card p-3 shadow-sm">
                                <form id="payment-type-form">
                                    <h2 class="text-primary">Adicionar Tipo de Pagamento</h2>
                                    <div class="mb-3">
                                        <label for="payment-type-name" class="form-label">Nome do Tipo:</label>
                                        <input type="text" class="form-control" id="payment-type-name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Aplicável para:</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="payment-type-income">
                                            <label class="form-check-label" for="payment-type-income">
                                                Entrada
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="payment-type-expense">
                                            <label class="form-check-label" for="payment-type-expense">
                                                Saída
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="payment-type-asset">
                                            <label class="form-check-label" for="payment-type-asset">
                                                Ativo
                                            </label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Adicionar Tipo de Pagamento</button>
                                </form>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Lista de Tipos de Pagamento</h2>
                                <ul id="payment-types-list" class="list-group list-group-flush"></ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Importar Compra -->
                <div id="importar-compra-page" class="page-content hidden">
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card p-3 shadow-sm">
                                <div class="text-center mb-4">
                                    <i class="fas fa-file-excel fa-3x text-success mb-3"></i>
                                    <h2 class="text-primary">Importar Compra de Supermercado</h2>
                                    <p class="text-muted">Faça upload de uma planilha Excel (.xlsx, .xls) ou CSV com os dados das compras</p>
                                </div>
                                
                                <!-- Etapa 1: Upload da Planilha -->
                                <div id="import-step-1" class="import-step">
                                    <div class="mb-3">
                                        <label for="spreadsheetFile" class="form-label">Arquivo da Planilha:</label>
                                        <input type="file" class="form-control" id="spreadsheetFile" accept=".xlsx,.xls,.csv">
                                        <div class="form-text">Formatos aceitos: .xlsx, .xls, .csv</div>
                                    </div>
                                    <div class="alert alert-info">
                                        <h6><i class="fas fa-info-circle"></i> Colunas Obrigatórias:</h6>
                                        <ul class="mb-0">
                                            <li><strong>numero_nota:</strong> Número da nota fiscal</li>
                                            <li><strong>nome_loja:</strong> Nome da loja/fornecedor</li>
                                            <li><strong>codigo_produto:</strong> Código do produto</li>
                                            <li><strong>nome_produto:</strong> Nome do produto</li>
                                            <li><strong>quantidade:</strong> Quantidade comprada</li>
                                            <li><strong>valor_unitario:</strong> Valor unitário</li>
                                            <li><strong>total:</strong> Valor total do item</li>
                                            <li><strong>data_compra:</strong> Data da compra</li>
                                        </ul>
                                    </div>
                                    <div class="text-center">
                                        <button class="btn btn-primary btn-lg" onclick="nextImportStep()">
                                            <i class="fas fa-upload"></i> Processar Planilha
                                        </button>
                                    </div>
                                </div>

                                <!-- Etapa 2: Visualização dos Dados -->
                                <div id="import-step-2" class="import-step" style="display: none;">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h4>Dados da Planilha</h4>
                                        <span class="badge bg-primary" id="invoice-count">0 notas fiscais</span>
                                    </div>
                                    <div class="table-responsive" style="max-height: 400px;">
                                        <table class="table table-sm table-striped">
                                            <thead class="table-dark sticky-top">
                                                <tr>
                                                    <th class="text-center" style="width: 10%;">Nota</th>
                                                    <th class="text-start" style="width: 30%;">Loja</th>
                                                    <th class="text-center" style="width: 15%;">Data</th>
                                                    <th class="text-end" style="width: 20%;">Total</th>
                                                    <th class="text-center" style="width: 10%;">Itens</th>
                                                </tr>
                                            </thead>
                                            <tbody id="import-invoices-list">
                                                <!-- Dados serão inseridos via JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="text-center mt-3">
                                        <button class="btn btn-success btn-lg" onclick="nextImportStep()">
                                            <i class="fas fa-arrow-right"></i> Configurar Importação
                                        </button>
                                    </div>
                                </div>

                                <!-- Etapa 3: Configuração Final -->
                                <div id="import-step-3" class="import-step" style="display: none;">
                                    <h4>Configuração Final</h4>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="import-account-select" class="form-label">Conta Bancária:</label>
                                                <select class="form-select" id="import-account-select" required>
                                                    <option value="">Selecione a conta</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="import-payment-type-select" class="form-label">Tipo de Pagamento:</label>
                                                <select class="form-select" id="import-payment-type-select" required>
                                                    <option value="">Selecione o tipo</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="installment-count" class="form-label">Número de Parcelas:</label>
                                                <select class="form-select" id="installment-count">
                                                    <option value="1">À vista (1 parcela)</option>
                                                    <option value="2">2 parcelas</option>
                                                    <option value="3">3 parcelas</option>
                                                    <option value="4">4 parcelas</option>
                                                    <option value="5">5 parcelas</option>
                                                    <option value="6">6 parcelas</option>
                                                    <option value="12">12 parcelas</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="first-installment-date" class="form-label">Data da Primeira Parcela:</label>
                                                <input type="date" class="form-control" id="first-installment-date">
                                                <div class="form-text">Deixe em branco para usar a data da compra</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Resumo da Importação:</label>
                                                <div class="card bg-light">
                                                    <div class="card-body py-2">
                                                        <small class="text-muted">
                                                            <div id="import-summary">-</div>
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <button class="btn btn-success btn-lg" onclick="finalizeImport()">
                                            <i class="fas fa-check"></i> Finalizar Importação
                                        </button>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compras Importadas -->
                <div id="compras-importadas-page" class="page-content hidden">
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Compras Importadas</h2>
                                <p class="text-muted">Gerencie as compras importadas das planilhas</p>
                                
                                <!-- Lista de Compras -->
                                <div class="table-responsive">
                                    <table class="table table-hover table-striped table-sm">
                                        <thead class="table-dark">
                                            <tr>
                                                <th class="text-center" style="width: 8%;">Nota Fiscal</th>
                                                <th class="text-start" style="width: 20%;">Fornecedor</th>
                                                <th class="text-center" style="width: 10%;">Data Compra</th>
                                                <th class="text-end" style="width: 12%;">Valor Total</th>
                                                <th class="text-center" style="width: 6%;">Parcelas</th>
                                                <th class="text-center" style="width: 6%;">Itens</th>
                                                <th class="text-start" style="width: 15%;">Conta</th>
                                                <th class="text-start" style="width: 15%;">Tipo Pagamento</th>
                                                <th class="text-center" style="width: 8%;">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="purchases-list">
                                            <!-- Compras serão inseridas via JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Produtos -->
                <div id="produtos-page" class="page-content hidden">
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Gerenciar Produtos</h2>
                                <p class="text-muted">Visualize e gerencie os produtos importados das compras</p>
                                
                                <!-- Filtros -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="product-search" placeholder="Buscar produtos por nome ou código...">
                                    </div>
                                    <div class="col-md-6">
                                        <button class="btn btn-primary" onclick="searchProducts()">
                                            <i class="fas fa-search"></i> Buscar
                                        </button>
                                        <button class="btn btn-secondary" onclick="loadAllProducts()">
                                            <i class="fas fa-list"></i> Ver Todos
                                        </button>
                                    </div>
                                </div>

                                <!-- Lista de Produtos -->
                                <div class="table-responsive">
                                    <table class="table table-hover table-striped table-sm">
                                        <thead class="table-dark">
                                            <tr>
                                                <th class="text-start" style="width: 25%;">Nome</th>
                                                <th class="text-center" style="width: 10%;">Código</th>
                                                <th class="text-start" style="width: 15%;">Fornecedores</th>
                                                <th class="text-end" style="width: 12%;">Preço Última Compra</th>
                                                <th class="text-center" style="width: 8%;">Quantidade Total</th>
                                                <th class="text-end" style="width: 12%;">Preço Médio</th>
                                                <th class="text-center" style="width: 10%;">Última Compra</th>
                                                <th class="text-center" style="width: 8%;">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="products-list">
                                            <!-- Produtos serão inseridos via JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transações -->
                <div id="transacoes-page" class="page-content hidden">
                    <!-- Seção Adicionar Transação (agora no topo) -->
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 id="form-title" class="text-primary">Adicionar Transação</h2>
                                <form id="transaction-form">
                                    <input type="hidden" id="transaction-id">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="account-select" class="form-label">Conta:</label>
                                            <select class="form-select" id="account-select" required></select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="type" class="form-label">Tipo:</label>
                                            <select class="form-select" id="type" required>
                                                <option value="income">Receita</option>
                                                <option value="expense">Despesa</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="category-select" class="form-label">Categoria:</label>
                                            <select class="form-select" id="category-select">
                                                <option value="">Nenhuma</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="payment-type-select" class="form-label">Tipo de Pagamento:</label>
                                            <select class="form-select" id="payment-type-select">
                                                <option value="">Nenhum</option>
                                            </select>
                                        </div>
                                        <div class="col-md-12">
                                            <label for="description" class="form-label">Descrição:</label>
                                            <input type="text" class="form-control" id="description" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="amount" class="form-label">Valor:</label>
                                            <div class="input-group">
                                                <span class="input-group-text">R$</span>
                                                <input type="number" class="form-control" id="amount" step="0.01" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="transaction-date" class="form-label">Data da Transação:</label>
                                            <div class="input-group">
                                                <span class="input-group-text calendar-icon-btn"><i class="fas fa-calendar-alt"></i></span>
                                                <input type="date" class="form-control d-none" id="transaction-date" required>
                                                <input type="text" class="form-control" id="transaction-date-display" readonly>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="multiplier-input" class="form-label">Multiplicador:</label>
                                            <input type="number" class="form-control" id="multiplier-input" value="1" min="1">
                                        </div>
                                        <div class="col-12">
                                            <button type="submit" id="submit-button" class="btn btn-primary w-100">Adicionar</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção Filtros de Transações -->
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Filtros de Transações</h2>
                                <form id="transaction-filters-form" class="mb-4">
                                    <div class="row g-3">
                                        <!-- Agrupamento de Filtros de Data e Tipo de Data -->
                                        <div class="col-md-6">
                                            <label for="filter-date-range-start" class="form-label">Período:</label>
                                            <div class="input-group">
                                                <input type="date" class="form-control" id="filter-date-range-start">
                                                <span class="input-group-text">até</span>
                                                <input type="date" class="form-control" id="filter-date-range-end">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label d-block">Tipo de Período:</label>
                                            <div class="d-flex flex-wrap">
                                                <div class="form-check form-check-inline me-3">
                                                    <input class="form-check-input" type="radio" name="filter-date-type" id="filter-date-type-created" value="created_at" checked>
                                                    <label class="form-check-label" for="filter-date-type-created">Lançamento</label>
                                                </div>
                                                <div class="form-check form-check-inline me-3">
                                                    <input class="form-check-input" type="radio" name="filter-date-type" id="filter-date-type-due" value="due_date">
                                                    <label class="form-check-label" for="filter-date-type-due">Vencimento</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="filter-date-type" id="filter-date-type-confirmed" value="confirmed_at">
                                                    <label class="form-check-label" for="filter-date-type-confirmed">Confirmação</label>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Checkboxes para Tipo de Transação e Seletor de Status -->
                                        <div class="col-md-6">
                                            <label class="form-label d-block">Tipo de Transação:</label>
                                            <div class="d-flex flex-wrap">
                                                <div class="form-check form-check-inline me-3">
                                                    <input class="form-check-input" type="checkbox" id="filter-type-income" value="income" checked>
                                                    <label class="form-check-label" for="filter-type-income">Receita</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox" id="filter-type-expense" value="expense" checked>
                                                    <label class="form-check-label" for="filter-type-expense">Despesa</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="filter-confirmed" class="form-label">Status:</label>
                                            <select class="form-select" id="filter-confirmed">
                                                <option value="">Todos</option>
                                                <option value="1">Confirmada</option>
                                                <option value="0">Não Confirmada</option>
                                            </select>
                                        </div>

                                        <!-- Botões de Ação -->
                                        <div class="col-12 d-flex justify-content-end mt-4">
                                            <button type="button" id="clear-filters-button" class="btn btn-secondary me-2"><i class="fas fa-times me-2"></i>Limpar Filtros</button>
                                            <button type="submit" id="apply-filters-button" class="btn btn-primary"><i class="fas fa-filter me-2"></i>Aplicar Filtros</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Seção Histórico de Transações (a tabela) -->
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Histórico de Transações</h2>
                                <div class="scrollable-list-container">
                                    <div class="table-responsive">
                                        <table class="table table-hover table-sm table-striped align-middle">
                                            <thead class="table-light">
                                                 <tr>
                                                     <th>Descrição</th>
                                                     <th style="width: 100px;">Valor</th>
                                                     <th style="width: 80px;">Tipo</th>
                                                     <th style="width: 120px;">Conta</th>
                                                     <th style="width: 120px;">Categoria</th>
                                                     <th style="width: 120px;">Pagamento</th>
                                                     <th style="width: 120px;">Lançamento</th>
                                                     <th style="width: 120px;">Vencimento</th>
                                                     <th style="width: 120px;">Confirmação</th>
                                                     <th style="width: 120px;">Criado Por</th>
                                                     <th style="width: 100px;">Ações</th>
                                                 </tr>
                                            </thead>
                                            <tbody id="transaction-table-body">
                                                 <!-- Transações serão inseridas via JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Usuários -->
                <div id="usuarios-page" class="page-content hidden">
                    <div class="row justify-content-center">
                        <div class="col-md-8 mb-4">
                            <div class="card p-3 shadow-sm mb-4">
                                <h2 class="text-primary">Usuários do Grupo</h2>
                                <ul id="group-users-list" class="list-group list-group-flush"></ul>
                            </div>
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Adicionar Colaborador</h2>
                                <form id="add-user-form" class="mt-3">
                                    <div class="mb-3">
                                        <label for="new-username" class="form-label">Nome do novo usuário:</label>
                                        <input type="text" class="form-control" id="new-username" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="new-password" class="form-label">Senha:</label>
                                        <input type="password" class="form-control" id="new-password" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="new-whatsapp" class="form-label">WhatsApp:</label>
                                        <input type="text" class="form-control" id="new-whatsapp" placeholder="(XX) XXXXX-XXXX">
                                    </div>
                                    <div class="mb-3">
                                        <label for="new-instagram" class="form-label">Instagram:</label>
                                        <input type="text" class="form-control" id="new-instagram" placeholder="@seuinstagram">
                                    </div>
                                    <div class="mb-3">
                                        <label for="new-email" class="form-label">Email:</label>
                                        <input type="email" class="form-control" id="new-email">
                                    </div>
                                    <button type="submit" class="btn btn-secondary w-100">Adicionar ao Grupo</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transferência -->
                <div id="transferencia-page" class="page-content hidden">
                    <div class="row">
                        <div class="col-md-8 offset-md-2 mb-4">
                            <div class="card p-3 shadow-sm">
                                <form id="transfer-form">
                                    <h2 class="text-primary">Transferir Saldo</h2>
                                    <div class="mb-3">
                                        <label for="from-account" class="form-label">Conta de Origem:</label>
                                        <select class="form-select" id="from-account" required>
                                            <option value="">Selecione a conta de origem</option>
                                        </select>
                                        <small class="text-muted">Saldo disponível: <span id="from-account-balance" class="fw-bold">R$ 0,00</span></small>
                                    </div>
                                    <div class="mb-3">
                                        <label for="to-account" class="form-label">Conta de Destino:</label>
                                        <select class="form-select" id="to-account" required>
                                            <option value="">Selecione a conta de destino</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="transfer-amount" class="form-label">Valor a Transferir:</label>
                                        <div class="input-group">
                                            <span class="input-group-text">R$</span>
                                            <input type="number" class="form-control" id="transfer-amount" step="0.01" min="0.01" required>
                                        </div>
                                        <small class="text-muted">Máximo disponível: <span id="max-transfer-amount" class="fw-bold text-success">R$ 0,00</span></small>
                                    </div>
                                    <div class="mb-3">
                                        <label for="transfer-description" class="form-label">Descrição da Transferência:</label>
                                        <input type="text" class="form-control" id="transfer-description" placeholder="Ex: Transferência entre contas" required>
                                    </div>
                                    <button type="submit" class="btn btn-success w-100" id="transfer-button" disabled>
                                        <i class="fas fa-exchange-alt me-2"></i>Transferir Saldo
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gerenciar Usuários (Admin) -->
                <div id="admin-users-page" class="page-content hidden">
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Gerenciar Usuários do Sistema</h2>
                                
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th>ID</th>
                                                <th>Usuário</th>
                                                <th>Email</th>
                                                <th>WhatsApp</th>
                                                <th>Instagram</th>
                                                <th>LGPD</th>
                                                <th>Grupo</th>
                                                <th>Papel</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="admin-users-list">
                                            <!-- Dados serão inseridos via JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card p-3 shadow-sm">
                                <h2 class="text-primary">Usuários Pendentes de Aprovação</h2>
                                <ul id="pending-users-list" class="list-group list-group-flush"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>

<!-- Modal de Edição de Usuário -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editUserModalLabel">Editar Usuário</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="edit-user-form">
                    <div class="mb-3">
                        <label for="edit-username" class="form-label">Nome de Usuário:</label>
                        <input type="text" class="form-control" id="edit-username" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-whatsapp" class="form-label">WhatsApp:</label>
                        <input type="text" class="form-control" id="edit-whatsapp" placeholder="(XX) XXXXX-XXXX">
                    </div>
                    <div class="mb-3">
                        <label for="edit-instagram" class="form-label">Instagram:</label>
                        <input type="text" class="form-control" id="edit-instagram" placeholder="@seuinstagram">
                    </div>
                    <div class="mb-3">
                        <label for="edit-email" class="form-label">Email:</label>
                        <input type="email" class="form-control" id="edit-email" required>
                    </div>
                    <div class="mb-3" id="edit-role-group" style="display: none;">
                        <label for="edit-role" class="form-label">Papel:</label>
                        <select class="form-select" id="edit-role">
                            <option value="user">user</option>
                            <option value="collaborator">collaborator</option>
                            <option value="admin">admin</option>
                        </select>
                    </div>
                    <div class="mb-3" id="edit-group-id-group" style="display: none;">
                        <label for="edit-group-id" class="form-label">ID do Grupo:</label>
                        <input type="number" class="form-control" id="edit-group-id" min="1">
                    </div>
                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="edit-consent-lgpd">
                        <label class="form-check-label" for="edit-consent-lgpd">Consentimento LGPD</label>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Salvar Alterações</button>
                    <p id="edit-user-error-message" class="text-danger text-center mt-3 hidden"></p>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Alteração de Senha -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changePasswordModalLabel">Alterar Senha</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="change-password-form">
                    <div class="mb-3">
                        <label for="current-password" class="form-label">Senha Atual:</label>
                        <input type="password" class="form-control" id="current-password" required>
                    </div>
                    <div class="mb-3">
                        <label for="new-password" class="form-label">Nova Senha:</label>
                        <input type="password" class="form-control" id="change-new-password" required>
                        <small class="form-text text-muted">Mínimo 6 caracteres, com maiúscula, minúscula, número e caractere especial.</small>
                        <div id="new-password-strength" class="mt-1"></div>
                    </div>
                    <div class="mb-3">
                        <label for="confirm-new-password" class="form-label">Confirmar Nova Senha:</label>
                        <input type="password" class="form-control" id="confirm-new-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Salvar Nova Senha</button>
                    <p id="change-password-error-message" class="text-danger text-center mt-3 hidden"></p>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Importação de Planilhas -->
<div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="importModalLabel">Importar Planilha de Compras</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Modal desabilitado - use a página de importação -->
                <div class="text-center">
                    <i class="fas fa-info-circle fa-3x text-info mb-3"></i>
                    <h4>Modal de Importação Desabilitado</h4>
                    <p class="text-muted">Use a página "Importar Compra" no menu lateral para fazer upload das planilhas.</p>
                    <button class="btn btn-primary" onclick="render.showPage('importar-compra')">
                        <i class="fas fa-arrow-right"></i> Ir para Página de Importação
                    </button>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="import-next-btn" onclick="nextImportStep()">Próximo</button>
                <button type="button" class="btn btn-success" id="import-finalize-btn" onclick="finalizeImport()" style="display: none;">Finalizar Importação</button>
            </div>
        </div>
    </div>
</div>